<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>写博客/修改博客</title>

</head>
<body>
<!-- 顶部导航 -->
<div class="headerpage"></div>
<!--顶部导航 over-->
<hr>

<!--中部主体-->
<div id="write-app">
    <div class="blogForm">
        <template>
            <el-form ref="form" :model="blogDto" label-width="80px">
                <el-form-item label="id" v-if="action == 'edit'" v-show="1==0">
                    <el-input v-model="blogDto.blogId"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-input v-model="blogDto.blogTitle" placeholder="请输入文章标题"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-select v-model="blogDto.blogCategoryId" placeholder="请选择内容板块">
                        <el-option label="商业" value="1"></el-option>
                        <el-option label="军事" value="2"></el-option>
                        <el-option label="文学" value="3"></el-option>
                        <el-option label="科技" value="4"></el-option>
                        <el-option label="艺术" value="5"></el-option>
                        <el-option label="体育" value="6"></el-option>
                        <el-option label="医学" value="7"></el-option>
                        <el-option label="财经" value="8"></el-option>
                        <el-option label="电竞" value="9"></el-option>
                    </el-select>
                </el-form-item>
                <!--el-form-item label="活动时间">
                    <el-col :span="11">
                        <el-date-picker type="date" placeholder="选择日期" v-model="form.date1"
                                        style="width: 100%;"></el-date-picker>
                    </el-col>
                    <el-col class="line" :span="2">-</el-col>
                    <el-col :span="11">
                        <el-time-picker placeholder="选择时间" v-model="form.date2" style="width: 100%;"></el-time-picker>
                    </el-col>
                </el-form-item>-->
                <!--<el-form-item label="活动性质">
                    <el-checkbox-group v-model="form.type">
                        <el-checkbox label="美食/餐厅线上活动" name="type"></el-checkbox>
                        <el-checkbox label="地推活动" name="type"></el-checkbox>
                        <el-checkbox label="线下主题活动" name="type"></el-checkbox>
                        <el-checkbox label="单纯品牌曝光" name="type"></el-checkbox>
                    </el-checkbox-group>
                </el-form-item>-->
                <!--<el-form-item label="特殊资源">
                    <el-radio-group v-model="form.resource">
                        <el-radio label="线上品牌商赞助"></el-radio>
                        <el-radio label="线下场地免费"></el-radio>
                    </el-radio-group>
                </el-form-item>-->
                <el-form-item>
                    <el-input type="textarea" :rows="30" v-model="blogDto.blogContent"
                              placeholder="请在这里开始你的创作~"></el-input>
                </el-form-item>
                <!--<el-form-item label="公开形式/草稿">
                    <el-switch v-model="form.delivery"></el-switch>
                </el-form-item>-->
                <el-form-item>
                    <el-button type="primary" @click="submitForm">保存</el-button>
                    <el-button type="primary" @click="goBack">取消</el-button>
                </el-form-item>
            </el-form>
        </template>
    </div>

</div>
<!--中部主体 over-->

<!--footer-->
<div class="footerpage"></div>
<!--footer over-->
<script src="../../js/jquery-3.4.1.min.js"></script>
<script>
    $(function () {
        /*公共部分
        * 导航栏
        * footer CopyRight
        */
        // $(".headerpage").load("load/header.html");/*浏览器容易引起跨域问题*/
        $(".headerpage").load("http://localhost:8080/templates/page/main/header.html");
        $(".footerpage").load("http://localhost:8080/templates/page/main/footer.html");
    });
</script>
<!--Vue框架-->
<script src="../../plugins/vue/vue.js"></script>
<!--Element-UI-->
<script src="../../plugins/element-ui/index.js"></script>
<link rel="stylesheet" href="../../plugins/element-ui/lib/theme-chalk/index.css">
<script src="../../plugins/element-ui/index.js"></script>

<!-- 引入axios -->
<script src="../../plugins/axios/axios.min.js"></script>
<script src="../../js/request.js"></script>
<script src="../../api/blog.js"></script>
<script src="../../js/index.js"></script>
<script>
    var urlParam = requestUrlParam("blogId")

    new Vue({
        var: id = this.urlParam,
        el: '#write-app',
        data() {
            return {
                action: '',
                counts: 0,
                page: 1,
                pageSize: 10,
                tableData: [],
                input: '',
                blogDto: {
                    blogId: 0,
                    blogTitle: '',
                    blogSubUrl: '',
                    blogCoverImage: '',
                    blogCreateTime: '',
                    blogUpdateTime: '',
                    blogStatus: 0,
                    blogAccess: 0,
                    blogAuthorId: 0,
                    blogCategoryId: undefined,
                    blogContent: '',

                    authorName: '',
                    categoryName: ''
                }
            }
        },
        computed: {},
        created() {
            this.init()
        },
        mounted() {
            var _this = this
            // 判断如果携带参数博客id，则为编辑按钮跳转
            if (id != null) {
                // 发送异步请求获取当前博客的内容
                axios.get("/blogs/" + id).then((resp) => {
                    //
                    _this.action = 'edit'
                    // 将返回的数据绑定到相应的位置
                    _this.blogDto = resp.data.data
                    // 将返回的数据blogCategoryId以字符串的形式返回给选框，就可以正常展示label而不是value了
                    _this.blogDto.blogCategoryId = resp.data.data.blogCategoryId.toString();
                    console.log(this.action)
                })
            } else {
                _this.action = 'write'
            }
        },
        methods: {
            async init() {
            },
            handleQuery() {
                this.init();
            },
            // 提交表单
            submitForm() {
                if (this.action == 'write') {
                    var blog = this.blogDto
                    saveBlog(blog).then(res => {
                        if (res.code === 1) {
                            this.$message.success('博客保存成功！')
                            this.goBack()
                        } else {
                            this.$message.error(res.msg || '操作失败')
                        }
                    }).catch(err => {
                        this.$message.error('请求出错了：' + err)
                    })
                } else if (this.action == 'edit') {
                    var blog = this.blogDto
                    updateBlog(blog).then(res => {
                        if (res.code === 1) {
                            this.$message.success('博客保存成功！')
                            this.goBack()
                        } else {
                            this.$message.error(res.msg || '操作失败')
                        }
                    }).catch(err => {
                        this.$message.error('请求出错了：' + err)
                    })
                }
            },
            // 保存成功后跳转回创作者中心
            goBack() {
                window.location.href = "author.html"
            },
        }
    })
</script>
</body>
</html>