<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Lite Blog 创作者中心</title>
    <link rel="stylesheet" href="author.css">
</head>

<body>
<!-- 顶部导航 -->
<div class="headerpage"></div>
<!--顶部导航 over-->
<hr>

<!--中部主体-->
<div id="author-app">
    <el-container>
        <el-aside width="100px"></el-aside>
        <el-container>
            <el-header><div class="grid-content bg-purple">
                <el-link href="/templates/page/main/blog-write.html">创建博客</el-link>
            </div></el-header>
            <el-main><div class="blog-list" align="center">
                <template>
                    <el-table
                            :data="blogList"
                            border="false"
                            style="width: 1500px ; line-height: normal"
                    >
                        <el-table-column
                                v-if="1==0"
                                prop="blogId"
                                label="id"
                                width="0">
                        </el-table-column>
                        <el-table-column
                                prop="blogTitle"
                                label="标题"
                                width="300"
                        >
                        </el-table-column>
                        <el-table-column
                                prop="blogCreateTime"
                                label="创建时间"
                                width="300"
                                align="center"
                        >
                        </el-table-column>
                        <el-table-column
                                prop="categoryName"
                                label="板块"
                                width="200"
                                align="center"
                        >
                        </el-table-column>
                        <el-table-column
                                label="操作"
                                width="200"
                                align="center"
                        >
                            <template slot-scope="scope">
                                <el-button @click="editHandle(scope.row.blogId)" size="small"
                                           icon="el-icon-edit">
                                </el-button>
                                <el-button @click="deleteHandle(scope.row.blogId)" size="small"
                                           icon="el-icon-delete" style="color: red">
                                </el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </template>
            </div></el-main>
        </el-container>
    </el-container>

</div>
<!--中部主体 over-->

<!--footer-->
<div class="footerpage"></div>
<!--footer over-->
<script src="../../js/jquery-3.4.1.min.js"></script>
<script>
    $(function () {
        /*公共部分
        * 导航栏
        * footer CopyRight
        */
        // $(".headerpage").load("load/header.html");/*浏览器容易引起跨域问题*/
        $(".headerpage").load("http://localhost:8080/templates/page/main/header.html");
        $(".footerpage").load("http://localhost:8080/templates/page/main/footer.html");
    });
</script>

<!-- 开发环境版本，包含了有帮助的命令行警告 -->
<!-- 引入组件库 -->
<script src="../../plugins/vue/vue.js"></script>
<script src="../../plugins/element-ui/index.js"></script>
<!--
<link rel="stylesheet" href="../../plugins/element-ui/lib/theme-chalk/index.css">
-->
<script src="../../plugins/element-ui/index.js"></script>

<!-- 引入axios -->
<script src="../../plugins/axios/axios.min.js"></script>
<script src="../../js/request.js"></script>
<script src="../../api/blog.js"></script>
<script>
    new Vue({
        el: '#author-app',
        data() {
            return {
                action: '',
                counts: 0,
                page: 1,
                pageSize: 10,
                blogList: [],
                input: '',
                blogId: 0
            }
        },
        computed: {},
        created() {
            this.init()
        },
        mounted() {
        },
        methods: {
            async init() {
                // 页面加载完成之后发送异步请求来查询博客数据
                var _this = this;
                axios({
                    method: "get",
                    url: "http://localhost:8080/blogs/getByAuthorId",
                }).then(function (resp) {
                    _this.blogList = resp.data.data;
                    console.log(this.blogId)
                })
                /*await getBlogPage({'page': this.page, 'pageSize': this.pageSize}).then(res => {
                    if (String(res.code) === '1') {
                        // this.blogList = res.data.records
                        this.counts = Number(res.data.total)
                    } else {
                        this.$message.error(res.msg || '操作失败')
                    }
                }).catch(err => {
                    this.$message.error('请求出错了：' + err)
                })*/
            },
            handleQuery() {
                this.page = 1;
                this.init();
            },
            // 删除
            deleteHandle(blogId) {
                this.$confirm('确认删除该博客, 是否继续?', '确定删除', {
                    'confirmButtonText': '确定',
                    'cancelButtonText': '取消',
                }).then(() => {
                    deleteBlog(blogId).then(res => {
                        if (res.code === 1) {
                            this.$message.success('删除成功！')
                            this.handleQuery()
                        } else {
                            this.$message.error(res.msg || '操作失败')
                        }
                    }).catch(err => {
                        this.$message.error('请求出错了：' + err)
                    })
                })
            },
            editHandle(blogId) {
                // 跳转到编辑页面，同时携带blogId参数
                window.location.href="blog-write.html?blogId="+ blogId
            }
        }
    })
</script>
</body>
